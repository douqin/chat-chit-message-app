<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>Api</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
            
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <h2 id="api">Api</h2>
<h3 id="auth-auth">Auth <code>/auth</code></h3>
<ul>
<li><code>[POST] /login</code>: login.
<ul>
<li>body: {username: String, password: String}.</li>
<li>result: {user : {iduser&quot;,&quot;lastname&quot;,&quot;firstname&quot;,&quot;phone&quot;: &quot;0842943637&quot;,&quot;birthday&quot;,&quot;gender&quot;,&quot;bio&quot;,&quot;username&quot;,&quot;avatar&quot;,&quot;background&quot;,&quot;email&quot;} , token : {token: String, refreshToken: String}}.</li>
</ul>
</li>
<li><code>[POST] /refresh-token</code>: refresh token.
<ul>
<li>body: {accessToken: String}.</li>
<li>result: {token: String}.</li>
</ul>
</li>
<li><code>[POST] /registry</code>: đăng ký.
<ul>
<li>body: {name: String, username: String, password: String}.</li>
</ul>
</li>
<li><code>[POST] /confirm-account</code>: xác nhận account.
<ul>
<li>body: {username: String, otp: String}.</li>
</ul>
</li>
<li><code>[POST] /reset-otp</code>: reset otp.
<ul>
<li>body: {username: String}.</li>
<li>result: {status: boolean}.</li>
</ul>
</li>
<li><code>[POST] /confirm-password</code>: xác nhận mật khẩu mới.
<ul>
<li>body: {username: String, otp: String, password: String}.</li>
</ul>
</li>
<li><code>[GET] /users/:username</code>: get thông tin tóm tắt của user.
<ul>
<li>result: {name: String, username:String, avatar:String, isActived: boolean }</li>
</ul>
</li>
</ul>
<h3 id="me-me">Me <code>/me</code></h3>
<ul>
<li><code>[GET] /profile</code>: get thông tin.
<ul>
<li>result: {_id: String, name: String, username: String, birthday: Date(JS) -&gt; String,
gender: boolean, avatar: String, avatarColor: String, coverImage: String}.</li>
</ul>
</li>
<li><code>[PUT] /profile</code>: update thông tin.
<ul>
<li>body: {name: String, birthday: Date(JS) -&gt; String, gender: int (0: nam, 1 nữ)}.</li>
</ul>
</li>
<li><code>[PATCH] /avatar</code>: update avatar.
<ul>
<li>body: {file: File}.</li>
<li>result: {avatar: String}.</li>
</ul>
</li>
<li><code>[PATCH] /cover-image</code>: update ảnh bìa.
<ul>
<li>body: {file: File}.</li>
<li>result: {coverImage: String}</li>
</ul>
</li>
<li><code>[PATCH] /avatar/base64</code>: update avatar base64.
<ul>
<li>body: {fileName, fileExtension, fileBase64}.</li>
<li>result: {avatar: String}.</li>
</ul>
</li>
<li><code>[PATCH] /cover-image/base64</code>: update ảnh bìa base64.
<ul>
<li>body: {fileName, fileExtension, fileBase64}.</li>
<li>result: {coverImage: String}</li>
</ul>
</li>
<li><code>[GET] /phone-books</code>: get danh bạ.
<ul>
<li>result: [{_id, name, username, birthday: Date(JS) -&gt; String, gender, avatar, avatarColor: String, background, status(gồm 4 trạng thái: FRIEND, FOLLOWER, YOU_FOLLOW, NO RELATIONSHIP), numberCommonGroup: int, numberCommonFriend: int, isExists: true}].</li>
<li>nếu không có {name, username, isExists: false}.</li>
</ul>
</li>
<li><code>[POST] /phone-books</code>: đồng bộ danh bạ.
<ul>
<li>body: {phones: [{name: String, phone: String}]}.</li>
</ul>
</li>
<li><code>[PATCH] /password</code>: đổi mật khẩu.
<ul>
<li>body: {oldPassword: String, newPassword: String}.</li>
</ul>
</li>
<li><code>[DELETE] /revoke-token</code>: đăng xuất tất cả, socket cho user đang đăng nhập tài khoản.
<ul>
<li>body: {password: String, key: String}.</li>
<li>result: {token: String, refreshToken: String}.</li>
<li>socket: io.emit('revoke-token', {key: String}).</li>
</ul>
</li>
</ul>
<h3 id="user-users">User <code>/users</code></h3>
<ul>
<li><code>[GET] /search?phone=</code>: tìm kiếm bằng phone.
<ul>
<li>result: {_id, name, username, birthday: Date(JS) -&gt; String, gender, avatar, coverImage}.</li>
</ul>
</li>
<li><code>[GET] /user/:username</code>: tim kiem user voi full thong tin
<ul>
<li>result: {_id, name, username, birthday: Date(JS) -&gt; String, gender, avatar, coverImage, status(gồm 4 trạng thái), numberCommonFriend: int}.</li>
</ul>
</li>
</ul>
<h3 id="friend-friends">Friend <code>/friends</code></h3>
<ul>
<li><code>[GET] </code>: get danh sách bạn bè.
<ul>
<li>param: {name: String}.</li>
<li>result: [{_id: String, name: String, username: String, avatar: String, isOnline: boolean, lastLogin: Date }].</li>
</ul>
</li>
<li><code>[POST] /:userId</code>: chấp nhận kết bạn, socket cho user đc kết bạn.
<ul>
<li>socket: io.emit('accept-friend', {_id, name, avatar }).</li>
<li>socket (TH lạ, thì cả 2 sẽ nhận được): io.emit('create-individual-group-when-was-friend', groupId).</li>
<li>socket(TH đã có nhắn tin, thì cả 2 sẽ nhận được): io.emit('new-message', groupId, message).</li>
</ul>
</li>
<li><code>[DELETE] /:userId</code>: xóa kết bạn (socket bắn tới thằng bị xóa).
<ul>
<li>socket: io.emit('deleted-friend', _id);</li>
</ul>
</li>
<li><code>[GET] /invites</code>: get danh sách lời mời kết bạn của bản thân.
<ul>
<li>result: [{_id: String, name: String, username: String, avatar: String, numberCommonGroup: int, numberCommonFriend: int }].</li>
</ul>
</li>
<li><code>[DELETE] /invites/:userId</code>: Xóa lời mời kết bạn (socket bắn tới thằng bị xóa).
<ul>
<li>socket: io.emit('deleted-friend-invite', _id);</li>
</ul>
</li>
<li><code>[GET] /invites/me</code>: get danh sách lời mời kết bạn của mình đã gởi.
<ul>
<li>result: [{_id: String, name: String, username: String, avatar: String, numberCommonGroup: int, numberCommonFriend: int }].</li>
</ul>
</li>
<li><code>[POST] /invites/me/:userId</code>: gởi lời mời kết bạn cho người khác, socket cho user đc gởi lời mời kết bạn.
<ul>
<li>socket: io.emit('send-friend-invite', { _id, name, avatar });</li>
</ul>
</li>
<li><code>[DELETE] /invites/me/:userId</code>: xóa gởi lời mời kết bạn cho người khác (socket bắn tới thằng bị xóa).
<ul>
<li>socket: io.emit('deleted-invite-was-send', _id);</li>
</ul>
</li>
<li><code>[GET] /suggest</code>: danh sách đề xuất bạn bè.
<ul>
<li>params: {page (default: 0), size (default: 12)}.</li>
<li>result: [{_id: String, name, username, avatar, numberCommonGroup: int, numberCommonFriend: int }].</li>
</ul>
</li>
</ul>
<h3 id="group-groups">group <code>/groups</code></h3>
<ul>
<li>
<p><code>[GET] </code>: get danh sách trò chuyện mới nhất.</p>
<ul>
<li>params: {name: String (default: '') , type: int (0: tất cả, không tìm tên ;1: cá nhân; 2: nhóm) (default: 0) }.</li>
<li>body : { cursor , limit}
<ul>
<li>P/s: cursor = -1 để lấy list gr mới nhất.</li>
</ul>
</li>
<li>result: [{_id: String, name: String, avatar: String, userId: String, friendStatus: String , type: boolean, numberUnread: int, isNotify, isJoinFromLink,
lastMessage: {
_id: String,
content: String,
type: String (TEXT, IMAGE, VIDEO,FILE),
createdAt: String,
user: {
_id: String,
name: String,
avatar: String
}
}
}].</li>
</ul>
</li>
<li>
<p><code>[GET] /:id</code>: get một group.</p>
</li>
<li>
<p><code>[POST] /individual-group/:userId</code>: tạo cuộc trò chuyện cá nhân (socket tới userId, nhận được socket này thì bắn socket join-group).</p>
<ul>
<li>result: { Group.Object }.
<ul>
<li>nếu group tồn tại trả về status code 400</li>
</ul>
</li>
<li>socket: io.emit('create-individual-group', groupId).</li>
</ul>
</li>
<li>
<p><code>[POST] /groups/community-group</code>: tạo cuộc trò chuyện nhóm.</p>
<ul>
<li>body: {name:String, userIds: [String]}.</li>
<li>socket: io.emit('create-group', groupId).</li>
<li>result: {_id: String}.</li>
</ul>
</li>
<li>
<p><code>[PATCH] /:id/name</code>: đổi biệt danh cá nhân hoặc đổi tên nhóm (nếu là nhóm thì có socket).</p>
<ul>
<li>body: {name: String}.</li>
<li>socket: io.emit('rename-group', groupId, groupName, message).</li>
</ul>
</li>
<li>
<p><code>[PATCH] /:id/avatar</code>: thay ảnh nhóm.</p>
<ul>
<li>body: {file: File}.</li>
<li>socket: io.emit('update-avatar-group', groupId, groupAvatar, message).</li>
<li>socket: io.emit('new-message', groupId, message).</li>
</ul>
</li>
<li>
<p><code>[PATCH] /:id/avatar/base64</code>: thay ảnh nhóm.</p>
<ul>
<li>body: {fileName, fileExtension, fileBase64}.</li>
<li>socket: io.emit('update-avatar-group', groupId, groupAvatar, message).</li>
<li>socket: io.emit('new-message', groupId, message).</li>
</ul>
</li>
<li>
<p><code>[DELETE] /:id/messages</code>: xóa tất cả tin nhắn.</p>
</li>
<li>
<p><code>[GET] /:id/members</code>: danh sách thành viên.</p>
</li>
<li>
<p><code>[POST] /:id/members</code>: thêm nhiều thành viên.</p>
<ul>
<li>body: {userIds: [String]}.</li>
<li>socket (đối với thành viên trong nhóm) : io.emit('new-message', groupId, message).</li>
<li>socket (đối với user đc add): io.emit('added-group', groupId).</li>
<li>socket: io.emit('update-member', groupId).</li>
</ul>
</li>
<li>
<p><code>[DELETE] /:id/members/:userId</code>: xóa thành viên.</p>
<ul>
<li>socket (đối với thành viên trong nhóm) : io.emit('new-message', groupId, message).</li>
<li>socket (đối với user bị xóa): io.emit('deleted-group', groupId).</li>
<li>socket: io.emit('update-member', groupId).</li>
</ul>
</li>
<li>
<p><code>[DELETE] /:id/members/leave</code>: Rời nhóm.</p>
<ul>
<li>socket: io.emit('new-message', groupId, message )</li>
<li>socket: io.emit('update-member', groupId).</li>
</ul>
</li>
<li>
<p><code>[DELETE] /:id</code>: xóa nhóm.</p>
<ul>
<li>socket: io.emit('delete-group', groupId ).</li>
</ul>
</li>
<li>
<p><code>[POST] /:id/members/join-from-link</code>: tham gia từ link.</p>
<ul>
<li>socket (đối với thành viên trong nhóm) : io.emit('new-message', groupId, message) (nội dung: 'Tham gia từ link').</li>
<li>socket (đối với user đc add): io.emit('added-group', groupId).</li>
<li>socket: io.emit('update-member', groupId).</li>
</ul>
</li>
<li>
<p><code>[PATCH] /:id/join-from-link/:isStatus</code>: trạng thái co cho tham gia vào link không (chỉ chủ nhóm) (isStatus: 0 or 1).</p>
</li>
<li>
<p><code>[GET] /:id/summary</code>: thông tin khi vào nhóm.</p>
<ul>
<li>result: {_id, name, avatar, users: [{name, avatar}] }.</li>
</ul>
</li>
<li>
<p><code>[GET] /:id/last-view</code>: danh sách last view của danh sách members.</p>
<ul>
<li>result: [{ user: {_id, name, avatar}, lastView: Date }].</li>
</ul>
</li>
<li>
<p><code>[POST] /:id/managers</code>: thêm người quản lý nhóm.</p>
<ul>
<li>body: {managerIds: [String]}.</li>
<li>socket: io.emit('add-managers', {groupId, managerIds})</li>
<li>socket: io.emit('new-message', groupId, message) (content: ADD_MANAGERS).</li>
</ul>
</li>
<li>
<p><code>[DELETE] /:id/managers</code>: xóa người quản lý nhóm.</p>
<ul>
<li>body: {managerIds: [String]}.</li>
<li>socket: io.emit('delete-managers', {groupId, managerIds})</li>
<li>socket: io.emit('new-message', groupId, message) (content: DELETE_MANAGERS).</li>
</ul>
</li>
</ul>
<h3 id="message-messages">Message <code>/messages</code>.</h3>
<ul>
<li><code>[GET] /:groupId</code>: danh sách tin nhắn theo cuộc trò chuyện.
<ul>
<li>params: {page: int(default: 0), size: int(default: 20) }.</li>
</ul>
</li>
<li><code>[GET] /channel/:channelId</code>: danh sách tin nhắn theo kênh.
<ul>
<li>params: {page: int(default: 0), size: int(default: 20) }.</li>
</ul>
</li>
<li><code>[GET] /:groupId/files</code>: danh sách tin nhắn dạng file.
<ul>
<li>params: {type: String (default tìm theo từng phân loại: ALL) (ALL, IMAGE, VIDEO, FILE), senderId: String (không bắt buộc), startTime: String(yyyy-mm-dd)(không bắt buộc), endTime: String(yyyy-mm-dd)(không bắt buộc)}.</li>
</ul>
</li>
<li><code>[POST] /text</code>: send tin nhắn dạng text.
<ul>
<li>body: {content: String, tags: [String] (không bắt buộc), replyMessageId: String (không bắt buộc), type: String (TEXT, HTML, NOTIFY, STICKER) , groupId: String, channelId: String}.</li>
<li>socket: io.emit('new-message', groupId, message).</li>
<li>socket (nếu là channel): io.emit('new-message-of-channel', groupId, channelId, message).</li>
</ul>
</li>
<li><code>[POST] /files</code>: send tin nhắn dạng file.
<ul>
<li>body: {file: File}.</li>
<li>params: {type: String ('IMAGE', 'VIDEO', 'FILE'), groupId: String, channelId: String }.</li>
<li>socket: io.emit('new-message', groupId, message).</li>
<li>socket (nếu là channel): io.emit('new-message-of-channel', groupId, channelId, message).</li>
<li>các file hợp lệ (tối đa 20MB): .png, .jpeg, .jpg, .gif, .mp3, .mp4, .pdf, .doc, .docx, .ppt, .pptx, .rar, .zip .</li>
</ul>
</li>
<li><code>[POST] /files/base64</code>: send tin nhắn dạng file base64.
<ul>
<li>body: {fileName, fileExtension, fileBase64}.</li>
<li>params: {type: String ('IMAGE', 'VIDEO', 'FILE'), groupId: String, channelId: String }.</li>
<li>socket: io.emit('new-message', groupId, message).</li>
<li>socket (nếu là channel): io.emit('new-message-of-channel', groupId, channelId, message).</li>
<li>các file hợp lệ (fileExtension) (tối đa 20MB): .png, .jpeg, .jpg, .gif, .mp3, .mp4, .pdf, .doc, .docx, .ppt, .pptx, .rar, .zip .</li>
</ul>
</li>
<li><code>[DELETE] /:id</code>: thu hồi tin nhắn.
<ul>
<li>socket: io.emit('delete-message', {groupId, channelId, id}).</li>
</ul>
</li>
<li><code>[DELETE] /:id/only</code>: xóa tin nhắn ở phía tôi.</li>
<li><code>[POST] /:id/reacts/:type</code>: thả reaction.
<ul>
<li>socket: io.emit('add-reaction', {groupId, channelId, messageId, user, type});</li>
</ul>
</li>
<li><code>[GET] /:id/share/:groupId</code>: chuyển tiếp tin nhắn có id sang cuộc trò chuyện có groupId.
<ul>
<li>socket: io.emit('new-message',groupId, message ).</li>
</ul>
</li>
<li><code>[PATCH] /:id/notify/:isNotify</code>: update thông báo (0 là tắt, 1 là bật).</li>
<li><code>[GET] /:id/summary</code>: thông tin khi vào nhóm.
<ul>
<li>result: {_id, name, avatar, users: [{name, avatar}] }.</li>
</ul>
</li>
</ul>
<h3 id="pin-message-pin-messages">Pin Message <code>/pin-messages</code>.</h3>
<ul>
<li><code>[GET] /:groupId</code>: list tin nhắn gim.</li>
<li><code>[POST] /:messageId</code>: gim tin nhắn (tối đa là 3 tin nhắn đc gim).</li>
<li><code>[DELETE] /:messageId</code>: xóa gim.
<ul>
<li>có 2 content (PIN_MESSAGE, NOT_PIN_MESSAGE).</li>
<li>socket: io.emit('new-message', groupId, message).</li>
<li>socket: io.emit('action-pin-message', groupId).</li>
</ul>
</li>
</ul>
<h3 id="vote-votes">Vote <code>/votes</code>.</h3>
<ul>
<li><code>[GET] /:groupId</code>: danh sách votes theo groupId.
<ul>
<li>params: { page, size }.</li>
</ul>
</li>
<li><code>[POST] </code>: tạo bình chọn.
<ul>
<li>body: {content: String, options: [String], groupId: String}.</li>
<li>result: {_id, user: {_id, name, avatar},content, type: 'VOTE', options: [{name, userIds: [String]}], userOptions: [{_id, name, avatar}], createdAt}.</li>
<li>socket: io.emit('new-message', groupId, voteMessage).</li>
</ul>
</li>
<li><code>[POST] /:messageId</code>: thêm bình chọn.
<ul>
<li>body: {options: [String]}.</li>
<li>socket: io.emit('update-vote-message', groupId, voteMessage).</li>
</ul>
</li>
<li><code>[DELETE] /:messageId</code>: xóa bình chọn.
<ul>
<li>body: {options: [String]}.</li>
<li>socket: io.emit('update-vote-message', groupId, voteMessage).</li>
</ul>
</li>
<li><code>[POST] /:messageId/choices</code>: chọn lựa chọn.
<ul>
<li>body: {options: [String]}.</li>
<li>socket: io.emit('update-vote-message', groupId, voteMessage).</li>
</ul>
</li>
<li><code>[DELETE] /:messageId/choices</code>: xóa lựa chọn.
<ul>
<li>body: {options: [String]}.</li>
<li>socket: io.emit('update-vote-message', groupId, voteMessage).</li>
</ul>
</li>
</ul>
<h2 id="admin">Admin</h2>
<h3 id="user-manager-adminusers-manager">User Manager <code>/admin/users-manager</code>.</h3>
<ul>
<li>
<p><code>[GET] </code>: get list users.</p>
<ul>
<li>params: {username: String (default: ''), page: int (default: 0), size: int(default: 20)}.</li>
<li>result: [{_id, name, username, gender, isActived, isDeleted, isAdmin }].</li>
</ul>
</li>
<li>
<p><code>[PATCH] /:id/:isDeleted</code>: cập nhật trạng thái hoạt động (isDeleted là 0(kích hoạt) và 1(không kích hoạt) ).</p>
</li>
</ul>
<h3 id="socket-server-nhận">Socket Server nhận</h3>
<ul>
<li>
<p>socket.on('typing', (groupId, me) =&gt; {
<a href="http://socket.broadcast.to">socket.broadcast.to</a>(groupId).emit('typing', groupId, me);
});</p>
</li>
<li>
<p>socket.on('not-typing', (groupId, me) =&gt; {
<a href="http://socket.broadcast.to">socket.broadcast.to</a>(groupId).emit('not-typing', groupId, me);
});</p>
</li>
<li>
<p>socket.on('get-user-online', (userId, ({isOnline, lastLogin}) =&gt; {} ))</p>
</li>
<li></li>
<li>
<p>socket.on('group-last-view', (groupId) =&gt; {}): để cập nhật lại last view của mình ở group hoặc channel đó (nếu là channel thì phải truyền cả 2 tham số).</p>
</li>
</ul>
<h3 id="socket-server-trả-về">Socket Server trả về</h3>
<ul>
<li>
<p>socket.emit('user-last-view', {groupId, channelId, userId, lastView: Date } ): user đã xem tin nhắn ở group hoặc channel.</p>
</li>
<li>
<p>new member join group</p>
<ul>
<li>event: ''</li>
<li>res data: {}</li>
</ul>
</li>
<li>
<p>invite group</p>
</li>
<li>
<p>member leave group</p>
</li>
<li>
<p>rename group</p>
</li>
<li>
<p>approval member</p>
</li>
<li>
<p>joinfromLink (socket to admin)</p>
</li>
<li>
<p>receive message:</p>
<ul>
<li>file:</li>
<li>text:</li>
</ul>
</li>
<li>
<p>react message:</p>
</li>
<li>
<p>update-last-view (user seen message)</p>
</li>
<li>
<p>recall message:</p>
</li>
<li>
<p>change pin</p>
</li>
</ul>

            
            
        </body>
        </html>